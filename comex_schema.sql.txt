CREATE USER comex 
	IDENTIFIED BY comex
	DEFAULT TABLESPACE users
	QUOTA UNLIMITED ON users;

create table comex.categoria (
	id integer GENERATED BY DEFAULT AS IDENTITY (START WITH 8) NOT NULL,
	nome varchar2(255) not null,
  	status varchar2(10) default 'ATIVA' not null,

	constraint pk_categoria primary key (id),
	constraint uk_categoria_nome unique (nome),
  	constraint valores_status check (status in ('ATIVA', 'INATIVA'))
);

create table comex.produto (
	id integer GENERATED BY DEFAULT AS IDENTITY (START WITH 8) NOT NULL,
	nome varchar2(255) not null,
  	descricao varchar2(1000),
  	preco_unitario decimal(10,2) not null,
  	quantidade_estoque integer not null,
  	categoria_id integer not null,
  	tipo varchar2(10) default 'NAO_ISENTO' not null,

	constraint pk_produto primary key (id),
	constraint uk_produto_nome unique (nome),
  	constraint fk_produto_categoria	foreign key (categoria_id) references comex.categoria (id),
  	constraint produto_valores_tipos check (tipo in ('ISENTO', 'NAO_ISENTO'))
);

create table comex.cliente (
	id integer GENERATED BY DEFAULT AS IDENTITY (START WITH 8) NOT NULL,
	nome varchar2(255) not null,
  	cpf char(14) not null,
  	telefone varchar2(20) not null,
	rua varchar2(255) not null,
  	numero varchar2(255) not null,
  	complemento varchar2(255),
	bairro varchar2(255) not null,
	cidade varchar2(255) not null,
	uf char(2) not null,

	constraint pk_cliente primary key (id),
	constraint uk_cliente_nome unique (nome),
	constraint uk_cliente_cpf unique (cpf)
);

create table comex.pedido (
	id integer GENERATED BY DEFAULT AS IDENTITY (START WITH 8) NOT NULL,
	data date not null,
  	cliente_id integer not NULL,

	constraint pk_pedido primary key (id),
  	constraint fk_pedido_cliente	foreign key (cliente_id) references comex.cliente (id)
);

create table comex.item_pedido (
	id integer GENERATED BY DEFAULT AS IDENTITY (START WITH 8) NOT NULL,
	  preco_unitario decimal(10,2) not null,
	  quantidade integer not null,
	  produto_id integer not null,
	  pedido_id integer not null,
	  desconto decimal(10,2),
	  tipo_desconto varchar2(10) default 'NENHUM' not null,

	constraint pk_item_pedido primary key (id),
  	constraint fk_item_pedido_produto foreign key (produto_id) references comex.produto (id),
 	constraint fk_item_pedido_pedido foreign key (pedido_id) references comex.pedido (id),
  	constraint item_pedido_valores_tipos_desconto check (tipo_desconto in ('QUANTIDADE', 'PROMOCAO', 'NENHUM'))
);
